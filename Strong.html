<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>30 Day Fitness Quest</title>
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 0; background: linear-gradient(135deg, #141E30, #243B55); color: #eee; overflow-x: hidden; }
    header { text-align: center; padding: 1rem; background: linear-gradient(to right, #00c6ff, #0072ff); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.4); position: relative; }
    .nav { position: absolute; top: 1rem; left: 1rem; font-size: 1.8rem; cursor: pointer; }
    .sidebar { height: 100%; width: 0; position: fixed; top: 0; left: 0; background: rgba(20,30,48,0.95); transition: 0.4s; overflow-x: hidden; padding-top: 60px; z-index: 100; }
    .sidebar a { display: block; padding: 12px 24px; font-size: 1.2rem; text-decoration: none; color: #ffcc00; }
    .sidebar a:hover { color: #fff; }
    .closebtn { position: absolute; top: 20px; right: 25px; font-size: 2rem; cursor: pointer; color: #ffcc00; }

    .section { display: none; padding: 1rem; }
    .active-section { display: block; }

    .profile, .reward { text-align: center; margin: 1rem auto; background: rgba(255,255,255,0.08); padding: 1rem; border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,0.4); max-width: 600px; }
    .day-card { background: rgba(255,255,255,0.05); margin: 1rem auto; padding: 1rem; border-radius: 12px; max-width: 500px; box-shadow: 0 2px 8px rgba(0,0,0,0.4); cursor: pointer; }
    .day-header { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; color: #00eaff; }
    .tasks, .motivation { margin-top: 1rem; display: none; }
    .tasks li { list-style: none; margin: 8px 0; }

    button { background: #ffcc00; border: none; padding: 10px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    button:hover { background: #ffd633; }

    .progress-bar { width: 90%; margin: 1rem auto; background: #444; border-radius: 20px; overflow: hidden; }
    .progress { height: 20px; background: linear-gradient(to right, #ffcc00, #ff8800); width: 0%; text-align: center; color: black; font-weight: bold; font-size: 12px; line-height: 20px; transition: width 0.5s; }
  </style>
</head>
<body>
  <header>
    <span class="nav" onclick="openNav()">â˜°</span>
    <h1>ğŸ’ª 30 Day Fitness Quest</h1>
    <p id="welcome"></p>
  </header>

  <div id="sidebar" class="sidebar">
    <span class="closebtn" onclick="closeNav()">Ã—</span>
    <a href="#" onclick="showSection('home')">ğŸ  Home</a>
    <a href="#" onclick="showSection('profile')">ğŸ‘¤ Profile</a>
    <a href="#" onclick="showSection('rewards')">ğŸ Rewards</a>
    <a href="#" onclick="showSection('settings')">âš™ï¸ Settings</a>
  </div>

<!-- Setup (new section for first-time players) -->
<div id="setup" class="section active-section">
  <div class="profile">
    <h2>ğŸ‘‹ Welcome to 30 Day Fitness Quest</h2>
    <p>Please enter your details to begin:</p>
    <input type="text" id="nameInput" placeholder="Enter your name"><br><br>

    <!-- Dropdown with only 2 goals -->
    <select id="goalInput">
      <option value="Muscle Gain">Muscle Gain ğŸ’ª</option>
      <option value="Focus Exercises">Focus Exercises ğŸ§˜</option>
    </select><br><br>

    <button onclick="saveSetup()">Start My Journey ğŸš€</button>

    <!-- ğŸ‘‡ This is where feedback will appear -->
    <p id="setupMessage" style="margin-top:15px; color:#ffcc00; font-weight:bold;"></p>
  </div>
</div>



  <div id="profile" class="section">
  <h2>ğŸ‘¤ Profile</h2>
  <p><strong>Name:</strong> <span id="profileName"></span></p>
  <p><strong>Goal:</strong> <span id="profileGoal"></span></p>
  <p><strong>Current Week:</strong> <span id="profileWeek"></span></p>
  <p><strong>Total Points:</strong> <span id="profilePoints"></span></p>
</div>

<div id="rewards" class="section">
  <h2>ğŸ Rewards Unlocked</h2>
  <ul id="rewardsList"></ul>
</div>

<div id="settings" class="section">
  <h2>âš™ï¸ Settings</h2>
  <button onclick="resetProgress()">Reset Progress</button>
</div>

<div id="home" class="section">
  <div class="profile">
    <h2>ğŸ“… Your Fitness Plan</h2>
    <p id="todayDate"></p> <!-- today's date will appear here -->
    <button id="startBtn" onclick="startOrContinueWeek()">Start Week</button>
    <div class="progress-bar"><div id="progress" class="progress"></div></div>
    <p id="week"></p>
    <p id="points"></p>
    <p>Upcoming Reward: <span id="reward"></span></p>

    <!-- new weekly goal section -->
    <div id="weeklyGoal" style="margin-top:1rem; text-align:center;"></div>
  </div>
  <div id="plan"></div>
</div>


  <footer style="text-align:center; margin:1rem;">âœ”ï¸ Tick daily tasks, earn points, unlock rewards ğŸš€</footer>

  <script>
      // ğŸ’¡ Motivation messages pool
  const motivations = [
    "ğŸ”¥ Stay strong, youâ€™ve got this!",
    "ğŸ’ª Small steps every day lead to big results.",
    "âš¡ Push harder than yesterday!",
    "ğŸŒŸ Progress, not perfection.",
    "ğŸ† One step closer to your best self.",
    "ğŸ”¥ Sweat today, shine tomorrow.",
    "ğŸ’¯ Discipline beats motivation."
  ];

   const weeksMuscleGain = {
  1:[{day:"Mon",tasks:["Push-ups 3x10","Squats 3x12","Plank 20s"]},
     {day:"Tue",tasks:["Run 15 min"]},
     {day:"Wed",tasks:["Push-ups 3x12","Squats 3x12","Plank 25s"]},
     {day:"Thu",tasks:["Push-ups 3x12","Lunges 3x10 each leg","Plank 25s"]},
     {day:"Fri",tasks:["Run 15 min"]},
     {day:"Sat",tasks:["Fun reward: Swimming / Cycling / Music"]},
     {day:"Sun",tasks:["Rest day"]}]
};

const weeksFocusOMAD = {
  1:[{day:"Mon",tasks:["Push-ups 3x8â€“12","Squats 3x10â€“12","Plank 20â€“30s"]},
     {day:"Tue",tasks:["Walk 15 min","Mobility 10 min"]},
     {day:"Wed",tasks:["Lunges 3x10 each leg","Squats 3x10","Side Plank 2x20s each side"]},
     {day:"Thu",tasks:["Push-ups 4x8â€“10","Dips 3x8â€“10","Plank w/ shoulder taps 2x10 each side"]},
     {day:"Fri",tasks:["Walk / cycle 15 min","Leg raises 3x10","Bird-dogs 3x12"]},
     {day:"Sat",tasks:["Yoga / Stretching 20 min","Breathing practice"]},
     {day:"Sun",tasks:["Rest day"]}]
};

    const rewards=["Nyama choma ğŸ–","Swimming ğŸŠ","Hiking ğŸŒ³","Cycling ğŸš´","Music ğŸ¶"];

    let player=JSON.parse(localStorage.getItem("fitness30Day"))||{name:"",goal:"",week:1,points:0,totalTasks:0,dayProgress:0,completed:{},startedWeek:false,rewardsAchieved:[]};

function saveSetup() {
  const name = document.getElementById("nameInput").value.trim();
  const goal = document.getElementById("goalInput").value;
  const messageEl = document.getElementById("setupMessage");

  if (!name) {
    messageEl.textContent = "âš ï¸ Please enter your name!";
    return;
  }

  // Check if this user already exists
  let storedPlayer = localStorage.getItem(`fitness30Day_${name}`);

  if (storedPlayer) {
    // âœ… Load existing profile
    player = JSON.parse(storedPlayer);
    messageEl.textContent = `âœ… Welcome back, ${player.name}! Resuming your journey.`;
  } else {
    // âœ… Create new profile and start Week 1 immediately
    player = {
      name: name,
      goal: goal,
      week: 1,
      points: 0,
      totalTasks: 0,
      dayProgress: 0,
      completed: {},
      startedWeek: true,
      rewardsAchieved: []
    };
    localStorage.setItem(`fitness30Day_${name}`, JSON.stringify(player));
    messageEl.textContent = `ğŸ‰ New profile created for ${player.name}. Your ${goal} journey begins now!`;
  }

  // Save current session user
  localStorage.setItem("fitness30Day_current", name);

  // âœ… Update UI
  document.getElementById("welcome").textContent = `Welcome, ${player.name}! Goal: ${player.goal}`;
  showSection("home");
  showPlan();
  updateProfile();
}

function savePlayer() {
  if (player && player.name) {
    localStorage.setItem(`fitness30Day_${player.name}`, JSON.stringify(player));
    localStorage.setItem("fitness30Day_current", player.name); // track who is logged in
  }
}

function startOrContinueWeek() {
  player.startedWeek = true;
  savePlayer();
  showPlan();
  updateProfile();

  let now = new Date();
  let todayIndex = now.getDay() - 1; // Monday = 0
  if (todayIndex < 0) todayIndex = 6;
  if (now.getHours() < 5) {
    todayIndex = todayIndex - 1;
    if (todayIndex < 0) todayIndex = 6;
  }

  const cards = document.querySelectorAll(".day-card");

  // âœ… Scroll to today's card
  const todayCard = cards[todayIndex];
  if (todayCard) {
    todayCard.scrollIntoView({ behavior: "smooth", block: "start" });

    // Expand today's card (tasks clickable)
    const mot = todayCard.querySelector(".motivation");
    const tasks = todayCard.querySelector(".tasks");
    mot.style.display = "block";
    tasks.style.display = "block";
  }

  // ğŸ‘€ Expand tomorrowâ€™s card (preview only, no clicks)
  const nextCard = cards[todayIndex + 1];
  if (nextCard) {
    const nextMot = nextCard.querySelector(".motivation");
    const nextTasks = nextCard.querySelector(".tasks");
    nextMot.style.display = "block";
    nextTasks.style.display = "block";

    // Disable checkboxes (make preview only)
    nextTasks.querySelectorAll("input[type='checkbox']").forEach(cb => {
      cb.disabled = true;
    });

    // Slightly dim tomorrowâ€™s card
    nextCard.style.opacity = "0.7";
  }
}

  function showPlan() {
  const container = document.getElementById("plan");
  container.innerHTML = "";
  const weekPlan = player.goal === "Focus Exercises"
    ? weeksFocusOMAD[player.week]
    : weeksMuscleGain[player.week];

  player.totalTasks = 0;

  if (!player.startedWeek) {
    container.innerHTML = "<p style='text-align:center;'>Click Start Week to begin âœ…</p>";
    return;
  }

  let now = new Date();
  let todayIndex = now.getDay() - 1; // Monday = 0
  if (todayIndex < 0) todayIndex = 6;
  if (now.getHours() < 5) {
    todayIndex = todayIndex - 1;
    if (todayIndex < 0) todayIndex = 6;
  }

  weekPlan.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "day-card";
    const locked = i > todayIndex;

    card.innerHTML = `
      <div class='day-header' style='${locked ? "opacity:0.5;pointer-events:none;" : ""}'>
        <span>${p.day}</span><span>â–¶ï¸</span>
      </div>
<div class='motivation'>
  <p><em>"${motivations[Math.floor(Math.random() * motivations.length)]}"</em></p>
  <p style="margin-top:6px;">Tasks for ${p.day}</p>
</div>


      <ul class='tasks'>
        ${p.tasks.map((t, idx) => {
          player.totalTasks++;
          const key = `${player.week}-${i}-${idx}`;
          const checked = player.completed[key] ? "checked" : "";
          return `<li><input type='checkbox' ${checked} onchange='completeTask(${i},${idx},this)'> ${t}</li>`;
        }).join("")}
      </ul>
    `;

    card.querySelector(".day-header").addEventListener("click", () => {
      const mot = card.querySelector(".motivation");
      const tasks = card.querySelector(".tasks");
      mot.style.display = mot.style.display === "block" ? "none" : "block";
      tasks.style.display = tasks.style.display === "block" ? "none" : "block";
    });

    // âœ… Always expand today's tasks
    if (i === todayIndex) {
      card.querySelector(".motivation").style.display = "block";
      card.querySelector(".tasks").style.display = "block";

      // âœ… Check if all today's tasks are already completed
      const todaysTasks = p.tasks.length;
      let completedToday = 0;
      for (let j = 0; j < todaysTasks; j++) {
        if (player.completed[`${player.week}-${i}-${j}`]) completedToday++;
      }
      if (completedToday === todaysTasks) {
        const message = document.createElement("p");
        message.id = `congrats-${i}`;
        message.style.color = "#ffcc00";
        message.style.fontWeight = "bold";
        message.style.marginTop = "10px";
        message.textContent = `ğŸ‰ Great job! You've already finished all tasks for ${p.day}.`;
        card.appendChild(message);
      }
    }

    container.appendChild(card);
  });

  scheduleRefreshAtFive();
}


function scheduleRefreshAtFive() {
  const now = new Date();
  let next5am = new Date();
  next5am.setHours(5, 0, 0, 0);

  // If it's already past 5 AM, set for tomorrow
  if (now >= next5am) {
    next5am.setDate(next5am.getDate() + 1);
  }

  const timeUntil5 = next5am - now;
  setTimeout(() => {
    location.reload(); // refresh at 5 AM
  }, timeUntil5);
}


function completeTask(day, task, box) {
  const key = `${player.week}-${day}-${task}`;
  if (box.checked) {
    if (!player.completed[key]) {
      player.completed[key] = true;
      player.points += 10;
      player.dayProgress++;
    }
  } else {
    if (player.completed[key]) {
      delete player.completed[key];
      player.points = Math.max(0, player.points - 10);
      player.dayProgress = Math.max(0, player.dayProgress - 1);
    }
  }
  savePlayer();
  updateProfile();

  // âœ… Select the correct week plan
  const weekPlan = player.goal === "Focus Exercises"
    ? weeksFocusOMAD[player.week]
    : weeksMuscleGain[player.week];

  let now = new Date();
  let todayIndex = now.getDay() - 1; // Monday = 0
  if (todayIndex < 0) todayIndex = 6;
  if (now.getHours() < 5) {
    todayIndex = todayIndex - 1;
    if (todayIndex < 0) todayIndex = 6;
  }

  const todaysTasks = weekPlan[todayIndex].tasks.length;

  let completedToday = 0;
  for (let i = 0; i < todaysTasks; i++) {
    if (player.completed[`${player.week}-${todayIndex}-${i}`]) completedToday++;
  }

  // Remove old message if it exists
  let oldMsg = document.querySelector(`#congrats-${todayIndex}`);
  if (oldMsg) oldMsg.remove();

  // âœ… Show congrats immediately after last task
  if (completedToday === todaysTasks) {
    const todayCard = document.querySelectorAll(".day-card")[todayIndex];
    const message = document.createElement("p");
    message.id = `congrats-${todayIndex}`;
    message.style.color = "#ffcc00";
    message.style.fontWeight = "bold";
    message.style.marginTop = "10px";
    message.textContent = `ğŸ‰ Great job! You've finished all tasks for ${weekPlan[todayIndex].day}. Come back tomorrow at the same time for your next challenge!`;
    todayCard.appendChild(message);
  }
}

function endWeek(){ if(player.points===player.totalTasks*10){ alert(`ğŸ‰ Week ${player.week} Complete!`); player.rewardsAchieved.push(rewards[(player.week-1)%rewards.length]); player.week++; player.points=0; player.completed={}; player.startedWeek=false; if(player.week>4){ alert("ğŸ† Challenge Complete!"); player.week=1; player.rewardsAchieved=[]; } savePlayer(); showPlan(); updateProfile(); } else { alert("âŒ Complete all tasks first!"); } }

  function updateProfile() {
  // Home section
  document.getElementById("week").textContent = "Current Week: " + player.week;
  document.getElementById("points").textContent = "Weekly Points: " + player.points;

  const percent = Math.floor((player.dayProgress / player.totalTasks) * 100) || 0;
  const progressEl = document.getElementById("progress");
  progressEl.style.width = percent + "%";
  progressEl.textContent = percent + "%";

  document.getElementById("startBtn").textContent = player.startedWeek ? "Continue Week" : "Start Week";
  document.getElementById("reward").textContent = rewards[(player.week - 1) % rewards.length];

  // Profile section
  document.getElementById("profileName").textContent = player.name;
  document.getElementById("profileGoal").textContent = player.goal;
  document.getElementById("profileWeek").textContent = player.week;
  document.getElementById("profilePoints").textContent = player.points;

  // Rewards section
  const rewardsList = document.getElementById("rewardsList");
  rewardsList.innerHTML = player.rewardsAchieved.length
    ? player.rewardsAchieved.map(r => `<li>${r}</li>`).join("")
    : "<li>No rewards unlocked yet.</li>";
}
function resetProgress() {
  if (confirm("Are you sure you want to reset all progress?")) {
    const currentUser = localStorage.getItem("fitness30Day_current");
    if (currentUser) {
      localStorage.removeItem(`fitness30Day_${currentUser}`);
      localStorage.removeItem("fitness30Day_current");
    }
    location.reload();
  }
}

    function openNav(){ document.getElementById("sidebar").style.width="250px"; }
    function closeNav(){ document.getElementById("sidebar").style.width="0"; }
    function showSection(id){ document.querySelectorAll(".section").forEach(s=>s.classList.remove("active-section")); document.getElementById(id).classList.add("active-section"); closeNav(); }

    showPlan(); updateProfile();
    function formatDate(date) {
  return date.toLocaleDateString("en-US", { day: "numeric", month: "short", year: "numeric" });
}

function getWeekRange(date) {
  const day = date.getDay(); // 0 = Sun
  const monday = new Date(date);
  monday.setDate(date.getDate() - ((day + 6) % 7));
  const sunday = new Date(monday);
  sunday.setDate(monday.getDate() + 6);
  return { monday, sunday };
}

function renderWeeklyGoal() {
  const now = new Date();
  let days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  let todayIdx = (now.getDay() + 6) % 7; // Mon=0

  const weekHTML = `
    <div style="
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:6px;
      margin-top:10px;
      max-width:100%;
    ">
      ${days.map((d,i)=>{
        const worked = Object.keys(player.completed).some(k=>{
          let [wk,dayIdx] = k.split("-").map(Number);
          return wk===player.week && dayIdx===i;
        });
        const isToday = i===todayIdx;
        return `<div style="
          padding:4px 6px;
          border-radius:6px;
          font-size:12px;
          background:${worked ? "#ffcc00" : "#444"};
          color:${isToday ? "#000" : "#eee"};
          font-weight:${isToday ? "bold" : "normal"};
          min-width:36px;
          text-align:center;
        ">${d}</div>`;
      }).join("")}
    </div>
  `;
  document.getElementById("weeklyGoal").innerHTML = weekHTML;
}

function updateProfile() {
  // existing profile update logic...
  document.getElementById("week").textContent = "Current Week: " + player.week;
  document.getElementById("points").textContent = "Weekly Points: " + player.points;

  const percent = Math.floor((player.dayProgress / player.totalTasks) * 100) || 0;
  const progressEl = document.getElementById("progress");
  progressEl.style.width = percent + "%";
  progressEl.textContent = percent + "%";

  document.getElementById("startBtn").textContent = player.startedWeek ? "Continue Week" : "Start Week";
  document.getElementById("reward").textContent = rewards[(player.week - 1) % rewards.length];

  // profile section
  document.getElementById("profileName").textContent = player.name;
  document.getElementById("profileGoal").textContent = player.goal;
  document.getElementById("profileWeek").textContent = player.week;
  document.getElementById("profilePoints").textContent = player.points;

  // rewards section
  const rewardsList = document.getElementById("rewardsList");
  rewardsList.innerHTML = player.rewardsAchieved.length
    ? player.rewardsAchieved.map(r => `<li>${r}</li>`).join("")
    : "<li>No rewards unlocked yet.</li>";

  // âœ… New: Todayâ€™s date + weekly goal
  document.getElementById("todayDate").textContent = "Today: " + formatDate(new Date());
  renderWeeklyGoal();
}

  </script>
</body>
</html>
